---
layout: blog
title: java和C++的多态实现
---

# java和C++的多态实现
## C++多态实现
C++对象分为继承下的对象和普通对象:

普通对象:
     成员+成员函数，按照声明顺序在内存中排列

单继承对象:
    vptr（虚指针） 指向一个虚函数表，表中依次排列父类和本类的method，假设有虚函数，则指向
父类相应的method的指针被替换为指向子类。 最后以NULL为结束（不同平台实现不同）
![Alt text](http://coolshell.cn//wp-content/uploads/2014/12/01.jpg)

多重继承对象:

![Alt text](http://coolshell.cn//wp-content/uploads/http://coolshell.cn//wp-content/uploads/2014/12/09.jpg)

## java多态实现
###java虚拟机中提供了5条方法调用字节码指令来实现多态
 
 - invokestatic: 调用静态方法
 - invokespecial: 调用构造器，私有方法和父类方法
 - invokevirtual: 调用所有的虚方法
 - invokeinterface: 调用接口
 - invokedynamic: 用户指定分派逻辑

###静态绑定
invokestatic和invokespecial是在编译期就确定调用的唯一版本。
###动态绑定
invokevirtual在方法区生成一个vtable，invokeinterface在方法区生成一个itable。当需要调用方法时，先找到操作数栈顶的第一个元素所指向的对象的实际类型，再根据类和方法找到方法区类型和方法名都相同的方法地址，该地址指向的是方法的实际入口地址。
